{% assign promo_container = block.id | replace: '_', '' | downcase %}

{% style %}
  .promo-bar-{{ promo_container }} {
    width: 100vw;
    padding: 10px 20px;
    overflow: hidden;
    display: flex;
  }

  .promo-bar-{{ promo_container }}::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    pointer-events: none;
  }

  .promo-bar-container-{{ promo_container }} {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 14px;
    flex-wrap: wrap;
  }

  .promo-bar-message-{{ promo_container }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.text_size }}px;
    font-weight: {{ block.settings.text_weight }};
    margin: 0;
    line-height: 1.3;
  }

  .promo-bar-code-{{ promo_container }} {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background-color: {{ block.settings.code_background }};
    border: 2px dashed {{ block.settings.code_border_color }};
    border-radius: {{ block.settings.border_radius }}px;
    padding: 6px 14px;
  }

  .promo-bar-code-text-{{ promo_container }} {
    color: {{ block.settings.code_text_color }};
    font-size: {{ block.settings.code_size }}px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    font-family: monospace;
  }

  .promo-bar-copy-btn-{{ promo_container }} {
    background-color: {{ block.settings.button_background_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    padding: 6px 12px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .promo-bar-copy-btn-{{ promo_container }}:hover {
    background-color: {{ block.settings.button_hover_color }};
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
  }

  .promo-bar-copy-btn-{{ promo_container }} svg {
    width: 14px;
    height: 14px;
  }

  .promo-bar-icon-{{ promo_container }}.hidden {
    display: none;
  }

  @media screen and (max-width: 749px) {
    .promo-bar-{{ promo_container }} {
      padding: 8px 14px;
    }

    .promo-bar-message-{{ promo_container }} {
      font-size: {{ block.settings.text_size | times: 0.9 }}px;
    }

    .promo-bar-code-{{ promo_container }} {
      flex-direction: column;
      gap: 6px;
    }
  }
{% endstyle %}

{% if localization.market.handle == 'hungary' %}
  <promo-bar-{{ promo_container }} class="promo-bar-{{ promo_container }}" {{ block.shopify_attributes }}>
    <div class="promo-bar-container-{{ promo_container }}">
      {% if block.settings.promo_text != blank %}
        <div class="promo-bar-message-{{ promo_container }}">{{ block.settings.promo_text }}</div>
      {% endif %}

      {% if block.settings.promo_code != blank %}
        <div class="promo-bar-code-{{ promo_container }}">
          <span class="promo-bar-code-text-{{ promo_container }}">{{ block.settings.promo_code }}</span>
          <button
            class="promo-bar-copy-btn-{{ promo_container }}"
            aria-label="Copy promo code"
            data-code="{{ block.settings.promo_code }}"
          >
            <svg class="promo-bar-icon-{{ promo_container }} promo-bar-copy-icon-{{ promo_container }}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            <svg class="promo-bar-icon-{{ promo_container }} promo-bar-check-icon-{{ promo_container }} hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </button>
        </div>
      {% endif %}
    </div>
  </promo-bar-{{ promo_container }}>

  <script>
    (function() {
      class PromoBar{{ promo_container }} extends HTMLElement {
        connectedCallback() {
          this.copyButton = this.querySelector('.promo-bar-copy-btn-{{ promo_container }}');
          this.copyIcon = this.querySelector('.promo-bar-copy-icon-{{ promo_container }}');
          this.checkIcon = this.querySelector('.promo-bar-check-icon-{{ promo_container }}');
          if (this.copyButton) this.copyButton.addEventListener('click', this.handleCopy.bind(this));
        }

        handleCopy() {
          const code = this.copyButton.dataset.code;
          navigator.clipboard.writeText(code).then(() => this.showSuccess()).catch(() => this.fallbackCopy(code));
        }

        fallbackCopy(text) {
          const textArea = document.createElement('textarea');
          textArea.value = text;
          textArea.style.position = 'fixed';
          textArea.style.left = '-9999px';
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          this.showSuccess();
        }

        showSuccess() {
          this.copyIcon.classList.add('hidden');
          this.checkIcon.classList.remove('hidden');
          setTimeout(() => {
            this.copyIcon.classList.remove('hidden');
            this.checkIcon.classList.add('hidden');
          }, 3000);
        }
      }
      customElements.define('promo-bar-{{ promo_container }}', PromoBar{{ promo_container }});
    })();
  </script>
{% endif %}

{% schema %}
{
  "name": "Hungarian promo code",
  "settings": [
    {
      "type": "header",
      "content": "Promo code"
    },
    {
      "type": "text",
      "id": "promo_text",
      "label": "Promo text",
      "default": "Special offer for Hungary!"
    },
    {
      "type": "text",
      "id": "promo_code",
      "label": "Promo code",
      "default": "HUNGARY20"
    },
    {
      "type": "header",
      "content": "Colors & Style"
    },
   
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 14
    },
    {
      "type": "color",
      "id": "code_background",
      "label": "Code background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "code_text_color",
      "label": "Code text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "code_border_color",
      "label": "Code border color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "code_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Code size",
      "default": 16
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    },
{
  "type": "color",
  "id": "background_gradient_color",
  "label": "Background gradient color",
  "default": "transparent"
}
  ],
  "presets": [
    {
      "name": "Hungarian promo code"
    }
  ]
}
{% endschema %}
